(()=>{var e={516:(e,t,n)=>{var i=n(747),s=n(622),r=n(87),o=require,a=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,l=process.versions.modules,h=process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":"node",d=r.arch(),f=r.platform(),p=process.env.LIBC||(function(e){return"linux"===e&&i.existsSync("/etc/alpine-release")}(f)?"musl":"glibc"),u=process.env.ARM_VERSION||("arm64"===d?"8":a.arm_version)||"",m=(process.versions.uv||"").split(".")[0];function _(e){return o(_.path(e))}function g(e){try{return i.readdirSync(e)}catch(e){return[]}}function b(e,t){var n=g(e).filter(t);return n[0]&&s.join(e,n[0])}function v(e){return/\.node$/.test(e)}function y(e){var t=e.split("."),n={file:e,specificity:0};if("node"===t.pop()){for(var i=0;i<t.length;i++){var s=t[i];if("node"===s||"electron"===s||"node-webkit"===s)n.runtime=s;else if("napi"===s)n.napi=!0;else if("abi"===s.slice(0,3))n.abi=s.slice(3);else if("uv"===s.slice(0,2))n.uv=s.slice(2);else if("armv"===s.slice(0,4))n.armv=s.slice(4);else{if("glibc"!==s&&"musl"!==s)continue;n.libc=s}n.specificity++}return n}}function w(e,t){return function(n){return!(null==n||n.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(n)||n.abi!==t&&!n.napi||n.uv&&n.uv!==m||n.armv&&n.armv!==u||n.libc&&n.libc!==p)}}function x(e){return function(t,n){return t.runtime!==n.runtime?t.runtime===e?-1:1:t.abi!==n.abi?t.abi?-1:1:t.specificity!==n.specificity?t.specificity>n.specificity?-1:1:0}}e.exports=_,_.path=function(e){e=s.resolve(e||".");try{var t=o(s.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!c){var n=b(s.join(e,"build/Release"),v);if(n)return n;var i=b(s.join(e,"build/Debug"),v);if(i)return i}var r=k(e);if(r)return r;var a=k(s.dirname(process.execPath));if(a)return a;var _=["platform="+f,"arch="+d,"runtime="+h,"abi="+l,"uv="+m,u?"armv="+u:"","libc="+p,"node="+process.versions.node,process.versions&&process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+_+"\n    loaded from: "+e+"\n");function k(e){var t=s.join(e,"prebuilds",f+"-"+d),n=g(t).map(y).filter(w(h,l)).sort(x(h))[0];if(n)return s.join(t,n.file)}},_.parseTags=y,_.matchTags=w,_.compareTags=x},810:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(549)),a=n(747),c=n(622),l=n(129),h=o.window.activeTextEditor,d=o.window.createOutputChannel("Novel"),f="";function p(e){n(605).createServer((function(e,t){t.writeHead(200,{"Content-Type":"text/html","Cache-Control":"private, max-age=0"}),t.end(f)})).listen(8080);var t=new(0,n(777).Server)({port:5001});return t.on("connection",(function(t){t.on("message",(function(n){console.log("Received: "+n),console.log(u()),"hello"===n?t.send(JSON.stringify(u())):"givemedata"===n&&(console.log("sending body"),t.send(v(e)))}))})),o.workspace.onDidChangeTextDocument((function(e){var n;e.document==(null===(n=o.window.activeTextEditor)||void 0===n?void 0:n.document)&&_.presskey(t)})),o.window.onDidChangeTextEditorSelection((function(e){e.textEditor==o.window.activeTextEditor&&_.presskey(t)})),o.workspace.onDidChangeConfiguration((function(e){console.log("setting changed"),t.clients.forEach((function(e){e.send(JSON.stringify(u()))}))})),_.presskey(t),t}function u(){var e=o.workspace.getConfiguration("Novel"),t=1.75,n=e.get("preview.font-family"),i=e.get("preview.fontsize"),s=parseInt(/(\d+)(\D+)/.exec(i)[1]),r=/(\d+)(\D+)/.exec(i)[2],a=e.get("preview.linelength"),c=e.get("preview.linesperpage");return{lineheightrate:t,fontfamily:n,fontsize:i,numfontsize:s,unitoffontsize:r,linelength:a,linesperpage:c,pagewidth:c*s*t*1.003+r,pageheight:a*s+r,lineheight:s*t+r}}var m=!1,_={publish:function(e){!function(e){e.clients.forEach((function(e){e.send(v("active"))}))}(e),m=!1,delete this.timeoutID},presskey:function(e){if(!m){var t=Math.ceil(o.window.activeTextEditor.document.getText().length/10),n=this,i=e;this.timeoutID=setTimeout((function(e){n.publish(e)}),t,i),m=!0}},cancel:function(){"number"==typeof this.timeoutID&&(window.clearTimeout(this.timeoutID),delete this.timeoutID)}};function g(){p(o.window.activeTextEditor),o.window.createWebviewPanel("preview","原稿プレビュー",o.ViewColumn.Two,{enableScripts:!0}).webview.html='\n    <html>\n        <head>\n            <style>\n            body{\n                width:100vw;\n                height:100vh;\n                overflor:hidden;\n            }\n            </style>\n        </head>\n        <body>\n            <iframe src="http://localhost:8080" frameBorder="0" style="min-width: 100%; min-height: 100%" />\n        </body>\n    </html>'}function b(){var e,t,n,i,s,r,h,f,p,u=(t=1.75,n=(e=o.workspace.getConfiguration("Novel")).get("preview.font-family"),i=e.get("preview.fontsize"),s=parseInt(/(\d+)(\D+)/.exec(i)[1]),r=/(\d+)(\D+)/.exec(i)[2],'<!DOCTYPE html>\n  <html lang="ja">\n  <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>Cat Coding</title>\n\n      <style>\n      @charset "UTF-8";\n      html {\n      /* 組み方向 */\n      -epub-writing-mode: vertical-rl;\n      -ms-writing-mode: tb-rl;\n      writing-mode: vertical-rl;\n  \n      orphans: 1;\n      widows: 1;\n      }\n  \n      * {\n      margin: 0;\n      padding: 0;\n      }\n  \n      @page {\n      size: 105mm 148mm;\n      width: 88mm;\n      /*  width: calc(84mm - 1q); */\n      height: 110mm;\n      margin-top: 20mm;\n      margin-bottom: auto;\n      margin-left: auto;\n      margin-right: auto;\n      /* 以下、マージンボックスに継承される */\n      font-size: 6pt;\n      font-family: "游明朝", "YuMincho", serif;\n      /* 本来不要（<span class="smaller"><span class="smaller">ルート要素の指定が継承される</span></span>）だが、現時点のvivliostyle.jsの制限により必要 */\n      vertical-align: top;\n      }\n  \n      @page :left {\n      margin-right: 10mm;\n      @top-left {\n          content: counter(page) "  <$projecttitle>";\n          margin-left: 12q;\n          margin-top: 135mm;\n          writing-mode: horizontal-tb;\n          /* CSS仕様上は@pageルール内に書けばよいが、現時点のvivliostyle.jsの制限によりここに書く */\n      }\n      }\n      @page :right {\n      margin-right: 14mm;\n      /* border-bottom: 1pt solid black; */\n      /* 右下ノンブル */\n      @top-right {\n          content: "<$fullname>　 "counter(page);\n          margin-right: 12q;\n          margin-top: 135mm;\n          writing-mode: horizontal-tb;\n          /* CSS仕様上は@pageルール内に書けばよいが、現時点のvivliostyle.jsの制限によりここに書く */\n      }\n      }\n  \n      html {\n      font-family: "游明朝", "YuMincho", serif;\n      font-weight: Medium;\n      text-align: justify;\n      }\n  \n      body{\n      }\n  \n      h1 {\n      /* フォント */\n      font-weight: Extrabold;\n      /* フォントサイズ */\n      font-size: 24q;\n      /* 字下げ */\n      text-indent: 0;\n      /* 直後の改ページ・改段禁止 */\n      page-break-before: always;\n      page-break-after: always;\n      line-height: 42q;\n      letter-spacing: 0.25em;\n      display: flex;\n      align-items: center;\n      }\n  \n      h2 {\n      /* フォント */\n      font-weight: Demibold;\n      /* フォントサイズ */\n      font-size: 16q;\n      /* 字下げ */\n      text-indent: 3em;\n      /* 直後の改ページ・改段禁止 */\n      page-break-before: always;\n      page-break-after: avoid;\n      line-height: 42q;\n      margin-left: 2em;\n      }\n  \n      h2.part {\n      width: 80mm;\n      padding: 0mm 35mm;\n      font-weight: bold;\n      font-size: 16q;\n      page-break-before: always;\n      page-break-after: always;\n      margin-left: 4em;\n      }\n  \n      h1 + h2 {\n      margin-right: 16pt;\n      }\n  \n      ruby > rt {\n      font-size: 6.5q;\n      }\n  \n      p {\n        font-size: calc(110mm / '+(h=e.get("preview.linelength"))+");\n        line height: 1.65;\n        text-indent: 0em;\n        hanging-punctuation: force-end;\n        line-break:strict;\n        page-break-inside: auto;\n    }\n \n      div.indent-1 p:first-of-type, div.indent-2 p:first-of-type, div.indent-3 p:first-of-type{\n        padding-block-start: calc( "+i+" * "+"1.75);\n        }\n\n        div.indent-1 p:last-of-type, div.indent-2 p:last-of-type, div.indent-3 p:last-of-type{\n        padding-block-end: calc( "+i+" * "+"1.75);\n        }\n\n    \n    div.indent-1 p{\n    height: calc( 110mm - ("+i+"));\n    padding-top: "+i+";\n    }\n\n    div.indent-2 p{\n    height: calc( 110mm - ("+i+" * 2));\n    padding-top: calc("+i+" * 2);\n    }\n\n    div.indent-3 p{\n    height: calc( 110mm - ("+i+" * 3));\n    padding-top: calc("+i+' * 3);\n    }\n\n        p.goth {\n        margin-top: 3em;\n        font-family: "游ゴシック", "YuGothic", san-serif;\n        margin-block-start: 1em;\n        margin-block-end: 1em;\n        }\n  \n        p.align-rb {\n        text-align: right;\n        }\n\n        p.goth + p.goth {\n        margin-block-start: -1em;\n        }\n\n        div.codes {\n        display: inline-block;\n        margin: 3em 1em;\n        writing-mode: horizontal-tb;\n        padding: 1em;\n        font-family: "Courier", monospace;\n        font-size: 0.8em;\n        }\n  \n      div.codes p {\n      text-orientation: sideways;\n      }\n  \n      p.star {\n      text-indent: 3em;\n      margin-right: 16pt;\n      margin-left: 16pt;\n      }\n  \n      hr {\n      border: none;\n      border-right: 1pt solid black;\n      height: 6em;\n      margin: auto 8.5pt;\n      }\n  \n      /* 縦中横 */\n      .tcy {\n      -webkit-text-combine: horizontal;\n      text-combine: horizontal;\n      -ms-text-combine-horizontal: all;\n      text-combine-horizontal: digit 2;\n      text-combine-upright: digit 2;\n      }\n  \n      /* 圏点（<span class="smaller">ゴマ</span>） */\n      em.sesame_dot {\n      font-style: normal;\n      -webkit-text-emphasis-style: sesame;\n      text-emphasis-style: sesame;\n      }\n  \n      /*著作者*/\n      .author {\n      position: absolute;\n      bottom: 0;\n      font-size: 8.5pt;\n      margin-top: 50pt;\n      letter-spacing: normal;\n      }\n  \n      /*画像＋キャプション*/\n      figure {\n      display: block;\n      width: 236pt;\n      -ms-writing-mode: lr-tb;\n      -webkit-writing-mode: horizontal-tb;\n      writing-mode: horizontal-tb;\n      }\n  \n      figure img {\n      width: 100%;\n      height: auto;\n      vertical-align: bottom;\n      }\n  \n      figcaption {\n      text-align: left;\n      font-size: 7pt;\n      }\n  \n      /*奥付*/\n      .colophon {\n      font-size: 7pt;\n      margin-right: 48pt;\n      }\n      /* 級さげ */\n      span.smaller{\n          font-size:6.5pt\n      }\n  \n    div.comment {\n        display:none;\n    }\n\n    p.blank {\n        color:transparent;\n    }\n\n  @media screen{\n      body {\n            writing-mode: vertical-rl;\n            font-family: '+n+";\n            height: "+(f=h*s+r)+";\n            overflow-y:hidden;\n            padding:0;\n        }\n        \n        #cursor {\n            background-color: rgb(125,125,125,);\n            animation-duration: 0.5s;\n            animation-name: cursorAnimation;\n            animation-iteration-count: infinite;\n        }\n  \n        p {\n            height: "+f+";\n            font-family: "+n+";\n            font-size: "+i+";\n            margin:0 0 0 0;\n            vertical-align: middle;\n        }\n          \n        em.side-dot {\n            font-style: normal;\n            text-emphasis: filled sesame rgb(128,128,128);\n            -webkit-text-emphasis: filled sesame rgb(128,128,128);\n        }\n        \n        span.tcy {\n            text-combine: horizontal;\n            -webkit-text-combine:horizontal;\n        }\n\n        @keyframes cursorAnimation {\n                from {\n                    background-color: rgba(66,66,66,0);\n                }\n            \n                to {\n                    background-color: rgba(125,125,125,0.7);\n                }\n            }\n  \n          body{\n              background-image:   linear-gradient(to right, rgba(50, 50, 50, 0.5) 0.5pt, rgba(0, 0, 50, 0.05) 10em);\n              background-size:    "+(e.get("preview.linesperpage")*s*t*1.003+r)+" "+f+";\n              background-repeat:  repeat-x;\n              background-position: right 0px;\n          }\n          p{\n              background-image:   linear-gradient( rgba(50, 50, 50, 1) 0.5pt, transparent 1pt),\n                                  linear-gradient(to right, rgba(50, 50, 50, 1) 0.5pt, rgba(0, 0, 50, 0.05) 1pt);\n              background-size:    "+(p=s*t+r)+" "+i+",\n                                  "+p+" "+i+";\n              background-repeat:  repeat,\n                                  repeat;\n              background-position: right 0px,\n                                  right 0px;\n          }\n\n          div.indent-1 p{\n            height: calc( "+f+" - ("+i+"));\n            padding-top: "+i+";\n            }\n        \n            div.indent-2 p{\n            height: calc( "+f+" - ("+i+" * 2));\n            padding-top: calc("+i+" * 2);\n            }\n        \n            div.indent-3 p{\n            height: calc( "+f+" - ("+i+" * 3));\n            padding-top: calc("+i+" * 3);\n            }\n\n        \n          span.comment{\n            display:block;\n            border-radius:1em;\n            border:1.5pt solid rgba(70,70,00,0.9);\n            padding:0.25em 0.25em;\n            position:absolute;\n            margin-right: -3em;\n            margin-top: 0.5em;\n            top: "+f+';\n            background-color:rgba(50,50,00,0.5);\n            max-width: 20em;\n          }\n\n          span.comment::before{\n            content: \'\';\n            position: absolute;\n            right: 1em;\n            top: -15px;\n            display: block;\n            width: 0;\n            height: 0;\n            border-right: 15px solid transparent;\n            border-bottom: 15px solid rgba(70,70,00,0.9);\n            border-left: 15px solid transparent;\n          }\n\n          span.commentbody{\n              margin:0.5em 1em;\n              writing-mode:lr-tb;\n              font-family:sans-serif;\n              font-size:0.8em;\n              line-height:1;\n          }\n  \n      }\n        </style>\n      <link rel="stylesheet" href="">\n  </head>\n  <body>\n  '+v("active")+"\n  \n  <script>\n  \n  setTimeout( (function(){\n      var width = document.body.clientWidth;\n      var cursor = document.getElementById('cursor');\n      var panelWidth = window.innerWidth;\n      var scrollEnd = cursor.offsetLeft - width + (panelWidth / 2);\n      window.scrollTo( scrollEnd , scrollEnd);\n      console.log(width, cursor, panelWidth, scrollEnd);\n  }), 1);\n\n<\/script>\n  </body>\n  </html>"),m=o.workspace.workspaceFolders[0].uri.fsPath,_=c.join(m,"publish.html"),g=c.join(m,""),b="vivliostyle build ",y=_;y=y.replace(/ /g,"\\ ");var w=g;w=w.replace(/ /g,"\\ "),d.appendLine("startig to publish: "+y),b=b+y+" -o "+w+"/output.pdf",d.appendLine("startig to publish: "+b),a.writeFile(_,u,(function(e){e&&console.log(e),d.appendLine("saving pdf to "+b),l.exec(b,(function(e,t,n){if(e)return console.log("stderr: "+n),void d.appendLine("stderr: "+n);d.appendLine("stdout: "+t),d.appendLine("PDFの保存が終わりました")})),d.appendLine("HTMLの書き込みが完了しました")}))}function v(e){var t,n,i,s=(h="active"===e?o.window.activeTextEditor:e).document.getText(),r=h?h.document.offsetAt(h.selection.anchor):0,a="";return("\n"==s.slice(r,r+1)?s.slice(0,r)+'<span id="cursor">　</span>'+s.slice(r):s.slice(0,r)+'<span id="cursor">'+s.slice(r,r+1)+"</span>"+s.slice(r+1)).split("\n").forEach((function(e){e.match(/^\s*$/)?a+='<p class="blank">_'+e+"</p>":e.match(/^<span id="cursor">$/)||e.match(/^<\/span>$/)?a+='<p class="blank">_</p><span id="cursor">':a+="<p>"+e+"</p>"})),t=a,n=o.workspace.getConfiguration("Novel"),i=new Array(0),(i=n.get("preview.userregex")).length>0&&i.forEach((function(e,n){var i=new RegExp(e[0],"gi"),s=e[1];t=t.replace(i,s)})),t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<p>［＃ここから[１1一]文字下げ］<\/p>/g,'<div class="indent-1">')).replace(/<p>［＃ここから[２2二]文字下げ］<\/p>/g,'<div class="indent-2">')).replace(/<p>［＃ここから[３3三]文字下げ］<\/p>/g,'<div class="indent-3">')).replace(/<p>［＃ここで字下げ終わり］<\/p>/g,"</div>")).replace(/<!-- (.+?) -->/g,'<span class="comment"><span class="commentbody">$1</span></span>')).replace(/｜([^｜\n]+?)《([^《]+?)》/g,"<ruby>$1<rt>$2</rt></ruby>")).replace(/([一-鿏々-〇]+?)《(.+?)》/g,"<ruby>$1<rt>$2</rt></ruby>")).replace(/(.+?)［＃「\1」に傍点］/g,'<em class="side-dot">$1</em>')}e.exports={activate:function(e){e.subscriptions.push(o.commands.registerCommand("Novel.vertical-preview",g)),e.subscriptions.push(o.commands.registerCommand("Novel.export-pdf",b)),e.subscriptions.push(o.commands.registerCommand("Novel.launch-preview-server",p)),f=a.readFileSync(c.join(e.extensionPath,"htdocs","index.html"))},deactivate:function(){}}},137:e=>{"use strict";e.exports=function(e){const t=e.length;let n=0;for(;n<t;)if(0==(128&e[n]))n++;else if(192==(224&e[n])){if(n+1===t||128!=(192&e[n+1])||192==(254&e[n]))return!1;n+=2}else if(224==(240&e[n])){if(n+2>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||224===e[n]&&128==(224&e[n+1])||237===e[n]&&160==(224&e[n+1]))return!1;n+=3}else{if(240!=(248&e[n]))return!1;if(n+3>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||128!=(192&e[n+3])||240===e[n]&&128==(240&e[n+1])||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}},311:(e,t,n)=>{"use strict";try{e.exports=n(516)(__dirname)}catch(t){e.exports=n(137)}},777:(e,t,n)=>{"use strict";const i=n(762);i.createWebSocketStream=n(404),i.Server=n(284),i.Receiver=n(957),i.Sender=n(330),e.exports=i},977:(e,t,n)=>{"use strict";const{EMPTY_BUFFER:i}=n(872);function s(e,t){if(0===e.length)return i;if(1===e.length)return e[0];const n=Buffer.allocUnsafe(t);let s=0;for(let t=0;t<e.length;t++){const i=e[t];n.set(i,s),s+=i.length}return s<t?n.slice(0,s):n}function r(e,t,n,i,s){for(let r=0;r<s;r++)n[i+r]=e[r]^t[3&r]}function o(e,t){const n=e.length;for(let i=0;i<n;i++)e[i]^=t[3&i]}function a(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function c(e){if(c.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=Buffer.from(e):ArrayBuffer.isView(e)?t=Buffer.from(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),c.readOnly=!1),t}try{const t=n(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}())),i=t.BufferUtil||t;e.exports={concat:s,mask(e,t,n,s,o){o<48?r(e,t,n,s,o):i.mask(e,t,n,s,o)},toArrayBuffer:a,toBuffer:c,unmask(e,t){e.length<32?o(e,t):i.unmask(e,t)}}}catch(t){e.exports={concat:s,mask:r,toArrayBuffer:a,toBuffer:c,unmask:o}}},872:e=>{"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},62:e=>{"use strict";class t{constructor(e,t){this.target=t,this.type=e}}class n extends t{constructor(e,t){super("message",t),this.data=e}}class i extends t{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}}class s extends t{constructor(e){super("open",e)}}class r extends t{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const o={addEventListener(e,t,o){if("function"!=typeof t)return;function a(e){t.call(this,new n(e,this))}function c(e,n){t.call(this,new i(e,n,this))}function l(e){t.call(this,new r(e,this))}function h(){t.call(this,new s(this))}const d=o&&o.once?"once":"on";"message"===e?(a._listener=t,this[d](e,a)):"close"===e?(c._listener=t,this[d](e,c)):"error"===e?(l._listener=t,this[d](e,l)):"open"===e?(h._listener=t,this[d](e,h)):this[d](e,t)},removeEventListener(e,t){const n=this.listeners(e);for(let i=0;i<n.length;i++)n[i]!==t&&n[i]._listener!==t||this.removeListener(e,n[i])}};e.exports=o},503:e=>{"use strict";const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function n(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.exports={format:function(e){return Object.keys(e).map((t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map((e=>[t].concat(Object.keys(e).map((t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const i=Object.create(null);if(void 0===e||""===e)return i;let s,r,o=Object.create(null),a=!1,c=!1,l=!1,h=-1,d=-1,f=0;for(;f<e.length;f++){const p=e.charCodeAt(f);if(void 0===s)if(-1===d&&1===t[p])-1===h&&(h=f);else if(32===p||9===p)-1===d&&-1!==h&&(d=f);else{if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===h)throw new SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f);const t=e.slice(h,d);44===p?(n(i,t,o),o=Object.create(null)):s=t,h=d=-1}}else if(void 0===r)if(-1===d&&1===t[p])-1===h&&(h=f);else if(32===p||9===p)-1===d&&-1!==h&&(d=f);else if(59===p||44===p){if(-1===h)throw new SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f),n(o,e.slice(h,d),!0),44===p&&(n(i,s,o),o=Object.create(null),s=void 0),h=d=-1}else{if(61!==p||-1===h||-1!==d)throw new SyntaxError(`Unexpected character at index ${f}`);r=e.slice(h,f),h=d=-1}else if(c){if(1!==t[p])throw new SyntaxError(`Unexpected character at index ${f}`);-1===h?h=f:a||(a=!0),c=!1}else if(l)if(1===t[p])-1===h&&(h=f);else if(34===p&&-1!==h)l=!1,d=f;else{if(92!==p)throw new SyntaxError(`Unexpected character at index ${f}`);c=!0}else if(34===p&&61===e.charCodeAt(f-1))l=!0;else if(-1===d&&1===t[p])-1===h&&(h=f);else if(-1===h||32!==p&&9!==p){if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===h)throw new SyntaxError(`Unexpected character at index ${f}`);-1===d&&(d=f);let t=e.slice(h,d);a&&(t=t.replace(/\\/g,""),a=!1),n(o,r,t),44===p&&(n(i,s,o),o=Object.create(null),s=void 0),r=void 0,h=d=-1}}else-1===d&&(d=f)}if(-1===h||l)throw new SyntaxError("Unexpected end of input");-1===d&&(d=f);const p=e.slice(h,d);return void 0===s?n(i,p,o):(void 0===r?n(o,p,!0):n(o,r,a?p.replace(/\\/g,""):p),n(i,s,o)),i}}},305:e=>{"use strict";const t=Symbol("kDone"),n=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[n]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[n]()}[n](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},196:(e,t,n)=>{"use strict";const i=n(761),s=n(977),r=n(305),{kStatusCode:o,NOOP:a}=n(872),c=Buffer.from([0,0,255,255]),l=Symbol("permessage-deflate"),h=Symbol("total-length"),d=Symbol("callback"),f=Symbol("buffers"),p=Symbol("error");let u;function m(e){this[f].push(e),this[h]+=e.length}function _(e){this[h]+=e.length,this[l]._maxPayload<1||this[h]<=this[l]._maxPayload?this[f].push(e):(this[p]=new RangeError("Max payload size exceeded"),this[p][o]=1009,this.removeListener("data",_),this.reset())}function g(e){this[l]._inflate=null,e[o]=1007,this[d](e)}e.exports=class{constructor(e,t,n){if(this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!u){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;u=new r(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[d];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,n=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n}))})),e}decompress(e,t,n){u.add((i=>{this._decompress(e,t,((e,t)=>{i(),n(e,t)}))}))}compress(e,t,n){u.add((i=>{this._compress(e,t,((e,t)=>{i(),n(e,t)}))}))}_decompress(e,t,n){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[l]=this,this._inflate[h]=0,this._inflate[f]=[],this._inflate.on("error",g),this._inflate.on("data",_)}this._inflate[d]=n,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush((()=>{const e=this._inflate[p];if(e)return this._inflate.close(),this._inflate=null,void n(e);const i=s.concat(this._inflate[f],this._inflate[h]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[h]=0,this._inflate[f]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,i)}))}_compress(e,t,n){const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[h]=0,this._deflate[f]=[],this._deflate.on("error",a),this._deflate.on("data",m)}this._deflate[d]=n,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=s.concat(this._deflate[f],this._deflate[h]);t&&(e=e.slice(0,e.length-4)),this._deflate[d]=null,this._deflate[h]=0,this._deflate[f]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)}))}}},957:(e,t,n)=>{"use strict";const{Writable:i}=n(413),s=n(196),{BINARY_TYPES:r,EMPTY_BUFFER:o,kStatusCode:a,kWebSocket:c}=n(872),{concat:l,toArrayBuffer:h,unmask:d}=n(977),{isValidStatusCode:f,isValidUTF8:p}=n(746);function u(e,t,n,i){const s=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,u),s[a]=i,s}e.exports=class extends i{constructor(e,t,n,i){super(),this._binaryType=e||r[0],this[c]=void 0,this._extensions=t||{},this._isServer=!!n,this._maxPayload=0|i,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0],i=t.length-e;e>=n.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,u(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[s.extensionName])return this._loop=!1,u(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,u(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,u(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,u(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,u(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,u(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,u(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,u(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,u(RangeError,"MASK must be set",!0,1002)}else if(this._masked)return this._loop=!1,u(RangeError,"MASK must be clear",!0,1002);if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,u(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,u(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&d(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[s.extensionName].decompress(e,this._fin,((e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(u(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const i=this.dataMessage();if(i)return t(i);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?l(t,e):"arraybuffer"===this._binaryType?h(l(t,e)):t,this.emit("message",n)}else{const n=l(t,e);if(!p(n))return this._loop=!1,u(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",n.toString())}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return u(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!f(t))return u(RangeError,`invalid status code ${t}`,!0,1002);const n=e.slice(2);if(!p(n))return u(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}}},330:(e,t,n)=>{"use strict";const{randomFillSync:i}=n(417),s=n(196),{EMPTY_BUFFER:r}=n(872),{isValidStatusCode:o}=n(746),{mask:a,toBuffer:c}=n(977),l=Buffer.alloc(4);class h{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const n=t.mask&&t.readOnly;let s=t.mask?6:2,r=e.length;e.length>=65536?(s+=8,r=127):e.length>125&&(s+=2,r=126);const o=Buffer.allocUnsafe(n?e.length+s:s);return o[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(o[0]|=64),o[1]=r,126===r?o.writeUInt16BE(e.length,2):127===r&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),t.mask?(i(l,0,4),o[1]|=128,o[s-4]=l[0],o[s-3]=l[1],o[s-2]=l[2],o[s-1]=l[3],n?(a(e,l,o,s,e.length),[o]):(a(e,l,e,0,e.length),[o,e])):[o,e]}close(e,t,n,i){let s;if(void 0===e)s=r;else{if("number"!=typeof e||!o(e))throw new TypeError("First argument must be a valid error code number");if(void 0===t||""===t)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{const n=Buffer.byteLength(t);if(n>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+n),s.writeUInt16BE(e,0),s.write(t,2)}}this._deflating?this.enqueue([this.doClose,s,n,i]):this.doClose(s,n,i)}doClose(e,t,n){this.sendFrame(h.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){const i=c(e);if(i.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,i,t,c.readOnly,n]):this.doPing(i,t,c.readOnly,n)}doPing(e,t,n,i){this.sendFrame(h.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){const i=c(e);if(i.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,i,t,c.readOnly,n]):this.doPong(i,t,c.readOnly,n)}doPong(e,t,n,i){this.sendFrame(h.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){const i=c(e),r=this._extensions[s.extensionName];let o=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&r&&(a=i.length>=r._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),r){const e={fin:t.fin,rsv1:a,opcode:o,mask:t.mask,readOnly:c.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,e,n]):this.dispatch(i,this._compress,e,n)}else this.sendFrame(h.frame(i,{fin:t.fin,rsv1:!1,opcode:o,mask:t.mask,readOnly:c.readOnly}),n)}dispatch(e,t,n,i){if(!t)return void this.sendFrame(h.frame(e,n),i);const r=this._extensions[s.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,r.compress(e,n.fin,((t,s)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof i&&i(e);for(let t=0;t<this._queue.length;t++){const n=this._queue[t][4];"function"==typeof n&&n(e)}}else this._bufferedBytes-=e.length,this._deflating=!1,n.readOnly=!1,this.sendFrame(h.frame(s,n),i),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}e.exports=h},404:(e,t,n)=>{"use strict";const{Duplex:i}=n(413);function s(e){e.emit("close")}function r(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let n=!0;function a(){n&&e._socket.resume()}e.readyState===e.CONNECTING?e.once("open",(function(){e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a)})):(e._receiver.removeAllListeners("drain"),e._receiver.on("drain",a));const c=new i({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",(function(t){c.push(t)||(n=!1,e._socket.pause())})),e.once("error",(function(e){c.destroyed||c.destroy(e)})),e.once("close",(function(){c.destroyed||c.push(null)})),c._destroy=function(t,n){if(e.readyState===e.CLOSED)return n(t),void process.nextTick(s,c);let i=!1;e.once("error",(function(e){i=!0,n(e)})),e.once("close",(function(){i||n(t),process.nextTick(s,c)})),e.terminate()},c._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),c._readableState.endEmitted&&c.destroy()):(e._socket.once("finish",(function(){t()})),e.close())):e.once("open",(function(){c._final(t)}))},c._read=function(){e.readyState!==e.OPEN||n||(n=!0,e._receiver._writableState.needDrain||e._socket.resume())},c._write=function(t,n,i){e.readyState!==e.CONNECTING?e.send(t,i):e.once("open",(function(){c._write(t,n,i)}))},c.on("end",r),c.on("error",o),c}},746:(e,t,n)=>{"use strict";function i(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999}function s(e){const t=e.length;let n=0;for(;n<t;)if(e[n]<128)n++;else if(192==(224&e[n])){if(n+1===t||128!=(192&e[n+1])||192==(254&e[n]))return!1;n+=2}else if(224==(240&e[n])){if(n+2>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||224===e[n]&&128==(224&e[n+1])||237===e[n]&&160==(224&e[n+1]))return!1;n+=3}else{if(240!=(248&e[n]))return!1;if(n+3>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||128!=(192&e[n+3])||240===e[n]&&128==(240&e[n+1])||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}try{let t=n(311);"object"==typeof t&&(t=t.Validation.isValidUTF8),e.exports={isValidStatusCode:i,isValidUTF8:e=>e.length<150?s(e):t(e)}}catch(t){e.exports={isValidStatusCode:i,isValidUTF8:s}}},284:(e,t,n)=>{"use strict";const i=n(614),{createHash:s}=n(417),{createServer:r,STATUS_CODES:o}=n(605),a=n(196),c=n(762),{format:l,parse:h}=n(503),{GUID:d,kWebSocket:f}=n(872),p=/^[+/0-9A-Za-z]{22}==$/;function u(e){e.emit("close")}function m(){this.destroy()}function _(e,t,n,i){e.writable&&(n=n||o[t],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...i},e.write(`HTTP/1.1 ${t} ${o[t]}\r\n`+Object.keys(i).map((e=>`${e}: ${i[e]}`)).join("\r\n")+"\r\n\r\n"+n)),e.removeListener("error",m),e.destroy()}e.exports=class extends i{constructor(e,t){if(super(),null==(e={maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e}).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=r(((e,t)=>{const n=o[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)})),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,i)=>{this.handleUpgrade(t,n,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(const e of this.clients)e.terminate();const t=this._server;t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?t.close((()=>this.emit("close"))):process.nextTick(u,this)}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",m);const s=void 0!==e.headers["sec-websocket-key"]&&e.headers["sec-websocket-key"].trim(),r=+e.headers["sec-websocket-version"],o={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!s||!p.test(s)||8!==r&&13!==r||!this.shouldHandle(e))return _(t,400);if(this.options.perMessageDeflate){const n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const t=h(e.headers["sec-websocket-extensions"]);t[a.extensionName]&&(n.accept(t[a.extensionName]),o[a.extensionName]=n)}catch(e){return _(t,400)}}if(this.options.verifyClient){const a={origin:e.headers[8===r?"sec-websocket-origin":"origin"],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(a,((r,a,c,l)=>{if(!r)return _(t,a||401,c,l);this.completeUpgrade(s,o,e,t,n,i)}));if(!this.options.verifyClient(a))return _(t,401)}this.completeUpgrade(s,o,e,t,n,i)}completeUpgrade(e,t,n,i,r,o){if(!i.readable||!i.writable)return i.destroy();if(i[f])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");const h=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${s("sha1").update(e+d).digest("base64")}`],p=new c(null);let u=n.headers["sec-websocket-protocol"];if(u&&(u=u.trim().split(/ *, */),u=this.options.handleProtocols?this.options.handleProtocols(u,n):u[0],u&&(h.push(`Sec-WebSocket-Protocol: ${u}`),p._protocol=u)),t[a.extensionName]){const e=t[a.extensionName].params,n=l({[a.extensionName]:[e]});h.push(`Sec-WebSocket-Extensions: ${n}`),p._extensions=t}this.emit("headers",h,n),i.write(h.concat("\r\n").join("\r\n")),i.removeListener("error",m),p.setSocket(i,r,this.options.maxPayload),this.clients&&(this.clients.add(p),p.on("close",(()=>this.clients.delete(p)))),o(p,n)}}},762:(e,t,n)=>{"use strict";const i=n(614),s=n(211),r=n(605),o=n(631),a=n(16),{randomBytes:c,createHash:l}=n(417),{URL:h}=n(835),d=n(196),f=n(957),p=n(330),{BINARY_TYPES:u,EMPTY_BUFFER:m,GUID:_,kStatusCode:g,kWebSocket:b,NOOP:v}=n(872),{addEventListener:y,removeEventListener:w}=n(62),{format:x,parse:k}=n(503),{toBuffer:S}=n(977),E=["CONNECTING","OPEN","CLOSING","CLOSED"],C=[8,13];class N extends i{constructor(e,t,n){super(),this._binaryType=u[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=N.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(n=t,t=void 0),L(this,e,t,n)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){u.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){const i=new f(this.binaryType,this._extensions,this._isServer,n);this._sender=new p(e,this._extensions),this._receiver=i,this._socket=e,i[b]=this,e[b]=this,i.on("conclude",I),i.on("drain",U),i.on("error",M),i.on("message",D),i.on("ping",$),i.on("pong",j),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",W),e.on("data",F),e.on("end",A),e.on("error",q),this._readyState=N.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=N.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[d.extensionName]&&this._extensions[d.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=N.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==N.CLOSED){if(this.readyState===N.CONNECTING){const e="WebSocket was closed before the connection was established";return B(this,this._req,e)}this.readyState!==N.CLOSING?(this._readyState=N.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,n){if(this.readyState===N.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===N.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||m,t,n)):P(this,e,n)}pong(e,t,n){if(this.readyState===N.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===N.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||m,t,n)):P(this,e,n)}send(e,t,n){if(this.readyState===N.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==N.OPEN)return void P(this,e,n);const i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[d.extensionName]||(i.compress=!1),this._sender.send(e||m,i,n)}terminate(){if(this.readyState!==N.CLOSED){if(this.readyState===N.CONNECTING){const e="WebSocket was closed before the connection was established";return B(this,this._req,e)}this._socket&&(this._readyState=N.CLOSING,this._socket.destroy())}}}function L(e,t,n,i){const o={protocolVersion:C[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!C.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${C.join(", ")})`);let a;t instanceof h?(a=t,e._url=t.href):(a=new h(t),e._url=t);const f="ws+unix:"===a.protocol;if(!(a.host||f&&a.pathname))throw new Error(`Invalid URL: ${e.url}`);const p="wss:"===a.protocol||"https:"===a.protocol,u=p?443:80,m=c(16).toString("base64"),g=p?s.get:r.get;let b;if(o.createConnection=p?O:T,o.defaultPort=o.defaultPort||u,o.port=a.port||u,o.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,o.headers={"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":m,Connection:"Upgrade",Upgrade:"websocket",...o.headers},o.path=a.pathname+a.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(b=new d(!0!==o.perMessageDeflate?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=x({[d.extensionName]:b.offer()})),n&&(o.headers["Sec-WebSocket-Protocol"]=n),o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(a.username||a.password)&&(o.auth=`${a.username}:${a.password}`),f){const e=o.path.split(":");o.socketPath=e[0],o.path=e[1]}let v=e._req=g(o);o.timeout&&v.on("timeout",(()=>{B(e,v,"Opening handshake has timed out")})),v.on("error",(t=>{null===v||v.aborted||(v=e._req=null,e._readyState=N.CLOSING,e.emit("error",t),e.emitClose())})),v.on("response",(s=>{const r=s.headers.location,a=s.statusCode;if(r&&o.followRedirects&&a>=300&&a<400){if(++e._redirects>o.maxRedirects)return void B(e,v,"Maximum redirects exceeded");v.abort();const s=new h(r,t);L(e,s,n,i)}else e.emit("unexpected-response",v,s)||B(e,v,`Unexpected server response: ${s.statusCode}`)})),v.on("upgrade",((t,i,s)=>{if(e.emit("upgrade",t),e.readyState!==N.CONNECTING)return;v=e._req=null;const r=l("sha1").update(m+_).digest("base64");if(t.headers["sec-websocket-accept"]!==r)return void B(e,i,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"],c=(n||"").split(/, */);let h;if(!n&&a?h="Server sent a subprotocol but none was requested":n&&!a?h="Server sent no subprotocol":a&&!c.includes(a)&&(h="Server sent an invalid subprotocol"),h)B(e,i,h);else{if(a&&(e._protocol=a),b)try{const n=k(t.headers["sec-websocket-extensions"]);n[d.extensionName]&&(b.accept(n[d.extensionName]),e._extensions[d.extensionName]=b)}catch(t){return void B(e,i,"Invalid Sec-WebSocket-Extensions header")}e.setSocket(i,s,o.maxPayload)}}))}function T(e){return e.path=e.socketPath,o.connect(e)}function O(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=o.isIP(e.host)?"":e.host),a.connect(e)}function B(e,t,n){e._readyState=N.CLOSING;const i=new Error(n);Error.captureStackTrace(i,B),t.setHeader?(t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),t.once("abort",e.emitClose.bind(e)),e.emit("error",i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function P(e,t,n){if(t){const n=S(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}n&&n(new Error(`WebSocket is not open: readyState ${e.readyState} (${E[e.readyState]})`))}function I(e,t){const n=this[b];n._socket.removeListener("data",F),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,1005===e?n.close():n.close(e,t)}function U(){this[b]._socket.resume()}function M(e){const t=this[b];t._socket.removeListener("data",F),t._readyState=N.CLOSING,t._closeCode=e[g],t.emit("error",e),t._socket.destroy()}function R(){this[b].emitClose()}function D(e){this[b].emit("message",e)}function $(e){const t=this[b];t.pong(e,!t._isServer,v),t.emit("ping",e)}function j(e){this[b].emit("pong",e)}function W(){const e=this[b];this.removeListener("close",W),this.removeListener("end",A),e._readyState=N.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",F),this[b]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",R),e._receiver.on("finish",R))}function F(e){this[b]._receiver.write(e)||this.pause()}function A(){const e=this[b];e._readyState=N.CLOSING,e._receiver.end(),this.end()}function q(){const e=this[b];this.removeListener("error",q),this.on("error",v),e&&(e._readyState=N.CLOSING,this.destroy())}E.forEach(((e,t)=>{const n={enumerable:!0,value:t};Object.defineProperty(N.prototype,e,n),Object.defineProperty(N,e,n)})),["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach((e=>{Object.defineProperty(N.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(N.prototype,`on${e}`,{configurable:!0,enumerable:!0,get(){const t=this.listeners(e);for(let e=0;e<t.length;e++)if(t[e]._listener)return t[e]._listener},set(t){const n=this.listeners(e);for(let t=0;t<n.length;t++)n[t]._listener&&this.removeListener(e,n[t]);this.addEventListener(e,t)}})})),N.prototype.addEventListener=y,N.prototype.removeEventListener=w,e.exports=N},129:e=>{"use strict";e.exports=require("child_process")},417:e=>{"use strict";e.exports=require("crypto")},614:e=>{"use strict";e.exports=require("events")},747:e=>{"use strict";e.exports=require("fs")},605:e=>{"use strict";e.exports=require("http")},211:e=>{"use strict";e.exports=require("https")},631:e=>{"use strict";e.exports=require("net")},87:e=>{"use strict";e.exports=require("os")},622:e=>{"use strict";e.exports=require("path")},413:e=>{"use strict";e.exports=require("stream")},16:e=>{"use strict";e.exports=require("tls")},835:e=>{"use strict";e.exports=require("url")},549:e=>{"use strict";e.exports=require("vscode")},761:e=>{"use strict";e.exports=require("zlib")}},t={},n=function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}(810);module.exports=n})();
//# sourceMappingURL=extension.js.map